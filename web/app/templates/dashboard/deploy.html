{% extends "dashboard/base.html" %}

{% block title %}Deploy Agent - AMOSKYS Neural Security{% endblock %}

{% block content %}
<div class="deploy-dashboard">
    <!-- Header -->
    <div class="neural-card">
        <div class="card-header">
            <h2 class="card-title">üöÄ Agent Deployment Center</h2>
        </div>
        <p style="color: var(--text-secondary);">
            Download and deploy AMOSKYS agents across your infrastructure. Each agent provides 
            comprehensive endpoint protection with real-time threat detection and response.
        </p>
    </div>

    <!-- Deployment Flow -->
    <div class="deployment-flow">
        <div class="flow-step">
            <div class="step-number">1</div>
            <div class="step-content">
                <h4>Create Token</h4>
                <p>Generate a deployment token for your target platform</p>
            </div>
        </div>
        <div class="flow-arrow">‚Üí</div>
        <div class="flow-step">
            <div class="step-number">2</div>
            <div class="step-content">
                <h4>Download Agent</h4>
                <p>Get the agent package for your operating system</p>
            </div>
        </div>
        <div class="flow-arrow">‚Üí</div>
        <div class="flow-step">
            <div class="step-number">3</div>
            <div class="step-content">
                <h4>Install & Configure</h4>
                <p>Run the installer with your deployment token</p>
            </div>
        </div>
        <div class="flow-arrow">‚Üí</div>
        <div class="flow-step">
            <div class="step-number">4</div>
            <div class="step-content">
                <h4>Monitor</h4>
                <p>View agent status in your dashboard</p>
            </div>
        </div>
    </div>

    <!-- Platform Downloads -->
    <div class="platforms-section">
        <h3 class="section-title">üì¶ Agent Packages</h3>
        
        <div class="platform-cards">
            <!-- Windows -->
            <div class="platform-download-card">
                <div class="platform-header">
                    <span class="platform-icon">ü™ü</span>
                    <div>
                        <h4>Windows Agent</h4>
                        <span class="version-badge">v1.0.0</span>
                    </div>
                </div>
                <div class="platform-details">
                    <div class="detail-row">
                        <span class="detail-label">Requirements</span>
                        <span class="detail-value">Windows 10 or later</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Size</span>
                        <span class="detail-value">~45 MB</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Format</span>
                        <span class="detail-value">MSI Installer</span>
                    </div>
                </div>
                <div class="platform-features">
                    <span class="feature-tag">Process Monitor</span>
                    <span class="feature-tag">Network Flow</span>
                    <span class="feature-tag">Registry Watch</span>
                    <span class="feature-tag">USB Monitor</span>
                </div>
                <div class="platform-actions">
                    <a href="/downloads/agents/amoskys-agent-windows-1.0.0.msi" class="download-btn" onclick="trackDownload('windows')">
                        ‚¨áÔ∏è Download for Windows
                    </a>
                    <button class="token-btn" onclick="goToTokenCreate('windows')">üîë Get Token</button>
                </div>
            </div>

            <!-- Linux -->
            <div class="platform-download-card">
                <div class="platform-header">
                    <span class="platform-icon">üêß</span>
                    <div>
                        <h4>Linux Agent</h4>
                        <span class="version-badge">v1.0.0</span>
                    </div>
                </div>
                <div class="platform-details">
                    <div class="detail-row">
                        <span class="detail-label">Requirements</span>
                        <span class="detail-value">Kernel 4.0+, glibc 2.17+</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Size</span>
                        <span class="detail-value">~35 MB</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Format</span>
                        <span class="detail-value">tar.gz + systemd</span>
                    </div>
                </div>
                <div class="platform-features">
                    <span class="feature-tag">eBPF Telemetry</span>
                    <span class="feature-tag">Auditd Integration</span>
                    <span class="feature-tag">Container Aware</span>
                    <span class="feature-tag">SSH Monitor</span>
                </div>
                <div class="platform-actions">
                    <a href="/downloads/agents/amoskys-agent-linux-1.0.0.tar.gz" class="download-btn" onclick="trackDownload('linux')">
                        ‚¨áÔ∏è Download for Linux
                    </a>
                    <button class="token-btn" onclick="goToTokenCreate('linux')">üîë Get Token</button>
                </div>
                <div class="install-snippet">
                    <code>curl -sSL https://get.amoskys.com/agent | sudo bash -s -- --token YOUR_TOKEN</code>
                    <button class="copy-btn" onclick="copySnippet(this)">üìã</button>
                </div>
            </div>

            <!-- macOS -->
            <div class="platform-download-card">
                <div class="platform-header">
                    <span class="platform-icon">üçé</span>
                    <div>
                        <h4>macOS Agent</h4>
                        <span class="version-badge">v1.0.0</span>
                    </div>
                </div>
                <div class="platform-details">
                    <div class="detail-row">
                        <span class="detail-label">Requirements</span>
                        <span class="detail-value">macOS 11 (Big Sur)+</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Size</span>
                        <span class="detail-value">~40 MB</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Format</span>
                        <span class="detail-value">PKG Installer</span>
                    </div>
                </div>
                <div class="platform-features">
                    <span class="feature-tag">ES Framework</span>
                    <span class="feature-tag">TCC Monitor</span>
                    <span class="feature-tag">Gatekeeper</span>
                    <span class="feature-tag">Full Disk Access</span>
                </div>
                <div class="platform-actions">
                    <a href="/downloads/agents/amoskys-agent-macos-1.0.0.pkg" class="download-btn" onclick="trackDownload('macos')">
                        ‚¨áÔ∏è Download for macOS
                    </a>
                    <button class="token-btn" onclick="goToTokenCreate('macos')">üîë Get Token</button>
                </div>
            </div>

            <!-- Docker -->
            <div class="platform-download-card">
                <div class="platform-header">
                    <span class="platform-icon">üê≥</span>
                    <div>
                        <h4>Docker / Kubernetes</h4>
                        <span class="version-badge">v1.0.0</span>
                    </div>
                </div>
                <div class="platform-details">
                    <div class="detail-row">
                        <span class="detail-label">Requirements</span>
                        <span class="detail-value">Docker 20.10+ / K8s 1.20+</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Image Size</span>
                        <span class="detail-value">~150 MB</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Registry</span>
                        <span class="detail-value">Docker Hub</span>
                    </div>
                </div>
                <div class="platform-features">
                    <span class="feature-tag">Sidecar Mode</span>
                    <span class="feature-tag">DaemonSet</span>
                    <span class="feature-tag">Helm Chart</span>
                    <span class="feature-tag">Low Overhead</span>
                </div>
                <div class="platform-actions">
                    <a href="https://hub.docker.com/r/amoskys/agent" class="download-btn" target="_blank">
                        üê≥ View on Docker Hub
                    </a>
                    <button class="token-btn" onclick="goToTokenCreate('docker')">üîë Get Token</button>
                </div>
                <div class="install-snippet">
                    <code>docker run -d -e AMOSKYS_TOKEN=YOUR_TOKEN amoskys/agent:1.0.0</code>
                    <button class="copy-btn" onclick="copySnippet(this)">üìã</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification -->
    <div class="neural-card">
        <div class="card-header">
            <h3 class="card-title">üîí Package Verification</h3>
        </div>
        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            All packages are signed and include SHA-256 checksums. Verify your download:
        </p>
        <div class="checksums">
            <div class="checksum-row">
                <span class="checksum-file">amoskys-agent-windows-1.0.0.msi</span>
                <code class="checksum-hash">sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855</code>
            </div>
            <div class="checksum-row">
                <span class="checksum-file">amoskys-agent-linux-1.0.0.tar.gz</span>
                <code class="checksum-hash">sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855</code>
            </div>
            <div class="checksum-row">
                <span class="checksum-file">amoskys-agent-macos-1.0.0.pkg</span>
                <code class="checksum-hash">sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855</code>
            </div>
        </div>
    </div>

    <!-- Help Section -->
    <div class="neural-card">
        <div class="card-header">
            <h3 class="card-title">üìö Need Help?</h3>
        </div>
        <div class="help-links">
            <a href="/docs/agent-installation" class="help-link">
                <span class="help-icon">üìñ</span>
                <div>
                    <strong>Installation Guide</strong>
                    <p>Step-by-step instructions for all platforms</p>
                </div>
            </a>
            <a href="/docs/agent-troubleshooting" class="help-link">
                <span class="help-icon">üîß</span>
                <div>
                    <strong>Troubleshooting</strong>
                    <p>Common issues and solutions</p>
                </div>
            </a>
            <a href="/docs/agent-faq" class="help-link">
                <span class="help-icon">‚ùì</span>
                <div>
                    <strong>FAQ</strong>
                    <p>Frequently asked questions</p>
                </div>
            </a>
            <a href="/dashboard/my-agents" class="help-link">
                <span class="help-icon">ü§ñ</span>
                <div>
                    <strong>My Agents</strong>
                    <p>View and manage your deployed agents</p>
                </div>
            </a>
        </div>
    </div>
</div>

<style>
.deploy-dashboard {
    max-width: 100%;
}

/* Deployment Flow */
.deployment-flow {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 12px;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.flow-step {
    display: flex;
    align-items: center;
    gap: 1rem;
    background: rgba(0, 255, 136, 0.05);
    padding: 1rem 1.5rem;
    border-radius: 8px;
    border: 1px solid rgba(0, 255, 136, 0.2);
}

.step-number {
    width: 40px;
    height: 40px;
    background: var(--neural-primary);
    color: #000;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
}

.step-content h4 {
    margin: 0;
    color: var(--text-primary);
    font-size: 1rem;
}

.step-content p {
    margin: 0.25rem 0 0;
    color: var(--text-muted);
    font-size: 0.85rem;
}

.flow-arrow {
    color: var(--neural-primary);
    font-size: 1.5rem;
    font-weight: bold;
}

/* Section Title */
.section-title {
    color: var(--text-primary);
    margin-bottom: 1.5rem;
}

/* Platform Cards */
.platform-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.platform-download-card {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.3s ease;
}

.platform-download-card:hover {
    border-color: var(--neural-primary);
    box-shadow: 0 8px 30px rgba(0, 255, 136, 0.15);
}

.platform-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.platform-header .platform-icon {
    font-size: 2.5rem;
}

.platform-header h4 {
    margin: 0;
    color: var(--text-primary);
}

.version-badge {
    background: rgba(0, 255, 136, 0.2);
    color: var(--neural-primary);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
}

.platform-details {
    margin-bottom: 1rem;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.detail-label {
    color: var(--text-muted);
    font-size: 0.9rem;
}

.detail-value {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.platform-features {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
}

.feature-tag {
    background: rgba(0, 255, 136, 0.1);
    color: var(--neural-primary);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
}

.platform-actions {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.download-btn {
    flex: 1;
    background: linear-gradient(135deg, var(--neural-primary), #00cc6a);
    color: #000;
    padding: 0.75rem 1rem;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
    text-align: center;
    transition: all 0.3s ease;
}

.download-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
}

.token-btn {
    background: transparent;
    color: var(--neural-primary);
    border: 1px solid var(--neural-primary);
    padding: 0.75rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.token-btn:hover {
    background: rgba(0, 255, 136, 0.1);
}

.install-snippet {
    background: var(--bg-tertiary);
    border: 1px solid rgba(0, 255, 136, 0.2);
    border-radius: 6px;
    padding: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.install-snippet code {
    flex: 1;
    font-size: 0.8rem;
    color: var(--neural-primary);
    overflow-x: auto;
    white-space: nowrap;
}

.copy-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    padding: 0.25rem;
}

/* Checksums */
.checksums {
    background: var(--bg-tertiary);
    border-radius: 8px;
    padding: 1rem;
}

.checksum-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    flex-wrap: wrap;
    gap: 0.5rem;
}

.checksum-row:last-child {
    border-bottom: none;
}

.checksum-file {
    color: var(--text-primary);
    font-weight: 500;
}

.checksum-hash {
    font-size: 0.75rem;
    color: var(--text-muted);
    word-break: break-all;
}

/* Help Links */
.help-links {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.help-link {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
}

.help-link:hover {
    border-color: var(--neural-primary);
    background: rgba(0, 255, 136, 0.05);
}

.help-icon {
    font-size: 1.5rem;
}

.help-link strong {
    color: var(--text-primary);
    display: block;
    margin-bottom: 0.25rem;
}

.help-link p {
    color: var(--text-muted);
    font-size: 0.85rem;
    margin: 0;
}

/* Responsive */
@media (max-width: 768px) {
    .deployment-flow {
        flex-direction: column;
    }
    
    .flow-arrow {
        transform: rotate(90deg);
    }
    
    .platform-actions {
        flex-direction: column;
    }
}
</style>

<script>
function goToTokenCreate(platform) {
    window.location.href = `/dashboard/my-agents?platform=${platform}`;
}

function trackDownload(platform) {
    // Analytics tracking would go here
    console.log(`Download initiated: ${platform}`);
}

function copySnippet(btn) {
    const code = btn.previousElementSibling.textContent;
    navigator.clipboard.writeText(code).then(() => {
        btn.textContent = '‚úÖ';
        setTimeout(() => btn.textContent = 'üìã', 2000);
    }).catch(() => {
        alert('Failed to copy. Please select and copy manually.');
    });
}
</script>
{% endblock %}
