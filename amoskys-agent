#!/usr/bin/env python3
"""
Amoskys Flow Agent

Entry point for the Amoskys distributed intelligence agent.
Loads configuration and starts the agent.
"""

import sys
import os
import argparse

# Add src to Python path
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

from amoskys.agents.flowagent.main import main
from amoskys.config import get_config, init_config, AmoskysConfig


def run_agent():
    parser = argparse.ArgumentParser(description="Amoskys Flow Agent")
    parser.add_argument('--config', help="Path to configuration YAML file")
    parser.add_argument('--wal-path', help="Override WAL database path")
    parser.add_argument('--bus-address', help="Override EventBus address")
    parser.add_argument('--send-rate', type=int, help="Override send rate (events/sec, 0=unlimited)")
    
    args = parser.parse_args()
    
    # Load configuration
    if args.config:
        config = AmoskysConfig.from_yaml(args.config)
    else:
        config = AmoskysConfig.from_env()
    
    # Apply CLI overrides
    if args.wal_path:
        config.agent.wal_path = args.wal_path
    
    if args.bus_address:
        config.agent.bus_address = args.bus_address
        
    if args.send_rate is not None:
        config.agent.send_rate = args.send_rate
    
    # Initialize global config
    init_config(config)
    
    # Start agent
    main()


if __name__ == "__main__":
    run_agent()
